/*
SETUP DATABASE ENVIROMENT FOR URL SHORTENER
Michi von Ah - August 2023
FOR POSTGRESQL
*/

-- CREATE TABLES
CREATE TABLE "url"(
	urlid INTEGER GENERATED BY DEFAULT AS IDENTITY,
	slug VARCHAR(20),
	destination TEXT,
	"description" VARCHAR(250),
	"enabled" BOOLEAN,
	creationdate DATE,
	fk_userid INTEGER,
	PRIMARY KEY(urlid)
);

CREATE TABLE "user"(
	userid INTEGER GENERATED BY DEFAULT AS IDENTITY,
	name VARCHAR(20),
	mail VARCHAR(250),
	token VARCHAR(250),
	PRIMARY KEY(userid)
);

CREATE TABLE "analytics"(
	analyticsid INTEGER GENERATED BY DEFAULT AS IDENTITY,
	date DATE,
	fk_urlid INTEGER,
	PRIMARY KEY(analyticsid)
);

-- SET FOREIGN KEYS
ALTER TABLE "url" ADD FOREIGN KEY(fk_userid) REFERENCES "user"(userid);
ALTER TABLE "analytics" ADD FOREIGN KEY(fk_urlid) REFERENCES "url"(urlid);

-- SET DEFAULT VALUES
ALTER TABLE "url" ALTER COLUMN "enabled" SET DEFAULT True;
ALTER TABLE "url" ALTER COLUMN "creationdate" SET DEFAULT CURRENT_DATE;
ALTER TABLE "analytics" ALTER COLUMN "date" SET DEFAULT CURRENT_DATE;